import{R as t,r as i,I as me,a as fe,a8 as V,Q as pe,ao as ve,ap as ge,L as he}from"./index.43a4cb6b.js";import{P as Ee,D as xe}from"./DeleteWineModal.c428df36.js";import{D as ke,W as ye}from"./DatePicker.fe8a2d95.js";import{p as we,v as Le,M as Ce,L as be,d as Se}from"./vinmonopolet.a433c829.js";import{S as J}from"./Spinner.3c4223c7.js";import{T as q,C as De}from"./Time.a44c7f60.js";import{T as _}from"./Trash.esm.a66f2978.js";import{A as Te}from"./AsideDisclosure.3dd2339e.js";import{E as ee}from"./ErrorBox.70150a54.js";import{I as K}from"./InfoBox.c5154725.js";import{u as Me}from"./useFetchSingleWine.c1a5b0db.js";import{T as Ne}from"./Title.c5b0fbb7.js";import"./Score.8b571a73.js";import"./Info.esm.a9dc6759.js";var b=new Map;b.set("bold",function(e){return t.createElement(t.Fragment,null,t.createElement("path",{d:"M132.5,61.3l9.6-9.7a44.1,44.1,0,0,1,62.3,62.3l-30.3,30.2a43.9,43.9,0,0,1-62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"24"}),t.createElement("path",{d:"M123.5,194.7l-9.6,9.7a44.1,44.1,0,0,1-62.3-62.3l30.3-30.2a43.9,43.9,0,0,1,62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"24"}))});b.set("duotone",function(e){return t.createElement(t.Fragment,null,t.createElement("path",{d:"M122.3,71.4l19.8-19.8a44.1,44.1,0,0,1,62.3,62.3l-28.3,28.2a43.9,43.9,0,0,1-62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),t.createElement("path",{d:"M133.7,184.6l-19.8,19.8a44.1,44.1,0,0,1-62.3-62.3l28.3-28.2a43.9,43.9,0,0,1,62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}))});b.set("fill",function(){return t.createElement(t.Fragment,null,t.createElement("path",{d:"M210,46a51.8,51.8,0,0,0-73.5,0L116.7,65.8A8,8,0,0,0,128,77.1l19.8-19.8a36.1,36.1,0,0,1,50.9,0,35.9,35.9,0,0,1,0,50.9l-28.3,28.3a36.1,36.1,0,0,1-50.9,0,8,8,0,1,0-11.3,11.3,52,52,0,0,0,73.5,0L210,119.5A51.8,51.8,0,0,0,210,46Z"}),t.createElement("path",{d:"M128,178.9l-19.8,19.8a36,36,0,0,1-50.9-50.9l28.3-28.3a36.1,36.1,0,0,1,50.9,0,8,8,0,0,0,11.3-11.3,52,52,0,0,0-73.5,0L46,136.5A52,52,0,1,0,119.5,210l19.8-19.8A8,8,0,0,0,128,178.9Z"}))});b.set("light",function(e){return t.createElement(t.Fragment,null,t.createElement("path",{d:"M122.3,71.4l19.8-19.8a44.1,44.1,0,0,1,62.3,62.3l-28.3,28.2a43.9,43.9,0,0,1-62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"12"}),t.createElement("path",{d:"M133.7,184.6l-19.8,19.8a44.1,44.1,0,0,1-62.3-62.3l28.3-28.2a43.9,43.9,0,0,1,62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"12"}))});b.set("thin",function(e){return t.createElement(t.Fragment,null,t.createElement("path",{d:"M122.3,71.4l19.8-19.8a44.1,44.1,0,0,1,62.3,62.3l-28.3,28.2a43.9,43.9,0,0,1-62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"8"}),t.createElement("path",{d:"M133.7,184.6l-19.8,19.8a44.1,44.1,0,0,1-62.3-62.3l28.3-28.2a43.9,43.9,0,0,1,62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"8"}))});b.set("regular",function(e){return t.createElement(t.Fragment,null,t.createElement("path",{d:"M122.3,71.4l19.8-19.8a44.1,44.1,0,0,1,62.3,62.3l-28.3,28.2a43.9,43.9,0,0,1-62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),t.createElement("path",{d:"M133.7,184.6l-19.8,19.8a44.1,44.1,0,0,1-62.3-62.3l28.3-28.2a43.9,43.9,0,0,1,62.2,0",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}))});var ze=function(n,a){return fe(n,a,b)},te=i.exports.forwardRef(function(e,n){return t.createElement(me,Object.assign({ref:n},e,{renderPath:ze}))});te.displayName="Link";const Ie=te;(function(){if(!(typeof window>"u"||typeof document>"u"||typeof HTMLElement>"u")){var e=!1;try{var n=document.createElement("div");n.addEventListener("focus",function(o){o.preventDefault(),o.stopPropagation()},!0),n.focus(Object.defineProperty({},"preventScroll",{get:function(){if(navigator&&typeof navigator.userAgent<"u"&&navigator.userAgent&&navigator.userAgent.match(/Edge\/1[7-8]/))return e=!1;e=!0}}))}catch{}if(HTMLElement.prototype.nativeFocus===void 0&&!e){HTMLElement.prototype.nativeFocus=HTMLElement.prototype.focus;var a=function(o){for(var r=o.parentNode,s=[],u=document.scrollingElement||document.documentElement;r&&r!==u;)(r.offsetHeight<r.scrollHeight||r.offsetWidth<r.scrollWidth)&&s.push([r,r.scrollTop,r.scrollLeft]),r=r.parentNode;return r=u,s.push([r,r.scrollTop,r.scrollLeft]),s},l=function(o){for(var r=0;r<o.length;r++)o[r][0].scrollTop=o[r][1],o[r][0].scrollLeft=o[r][2];o=[]},d=function(o){if(o&&o.preventScroll){var r=a(this);this.nativeFocus(),typeof setTimeout=="function"?setTimeout(function(){l(r)},0):l(r)}else this.nativeFocus()};HTMLElement.prototype.focus=d}}})();var ne=function(e){return"".concat(e,"ms")},We=function(e){var n=e.height,a=e.innerHeight,l=e.innerWidth,d=e.width,o=e.zoomMargin,r=l/(d+o),s=a/(n+o),u=Math.min(r,s);return u},Be=function(e){var n=e.height,a=e.innerHeight,l=e.innerWidth,d=e.isLoaded,o=e.isUnloading,r=e.left,s=e.originalTransform,u=e.top,v=e.transitionDuration,m=e.width,g=e.zoomMargin,h=ne(v);if(!d||o){var k=V(["scale(1)","translate(0, 0)"],s?[s]:[],!0).join(" ");return{height:n,left:r,top:u,transform:k,WebkitTransform:k,transitionDuration:h,width:m}}var E=We({height:n,innerWidth:l,innerHeight:a,width:m,zoomMargin:g}),f=l/2,c=a/2,S=r+m/2,y=u+n/2,C=(f-S)/E,M=(c-y)/E,w=V(["scale(".concat(E,")"),"translate(".concat(C,"px, ").concat(M,"px)")],s?[s]:[],!0).join(" ");return{height:n,left:r,top:u,transform:w,WebkitTransform:w,transitionDuration:h,width:m}},Ae=function(e){var n=e.isLoaded,a=e.isUnloading,l=e.overlayBgColorEnd,d=e.overlayBgColorStart,o=e.transitionDuration,r=e.zoomZindex,s={backgroundColor:d,transitionDuration:ne(o),zIndex:r};return n&&!a&&(s.backgroundColor=l),s},je={getBoundingClientRect:function(){return{height:0,left:0,top:0,width:0}},style:{transform:null}},Ze=function(e){i.exports.useEffect(e,[])},Fe=function(e){var n=i.exports.useRef(e);n.current=e,Ze(function(){return function(){return n.current()}})},Re=function(e){var n=i.exports.useRef(0),a=i.exports.useState(e),l=a[0],d=a[1],o=i.exports.useCallback(function(r){cancelAnimationFrame(n.current),n.current=requestAnimationFrame(function(){d(r)})},[]);return Fe(function(){cancelAnimationFrame(n.current)}),[l,o]},Pe=function(e,n){e===void 0&&(e=1/0),n===void 0&&(n=1/0);var a=typeof window<"u",l=Re({width:a?window.innerWidth:e,height:a?window.innerHeight:n}),d=l[0],o=l[1];return i.exports.useEffect(function(){if(a){var r=function(){o({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",r),function(){window.removeEventListener("resize",r)}}},[a,o]),d};function $(e){var n=i.exports.useRef();return i.exports.useEffect(function(){n.current=e}),n.current}var Ue=function(e){var n=e.children,a=e.closeText,l=a===void 0?"Unzoom Image":a,d=e.isActive,o=e.onLoad,r=e.onUnload,s=e.onZoomChange,u=e.overlayBgColorEnd,v=u===void 0?"rgba(255, 255, 255, 0.95)":u,m=e.overlayBgColorStart,g=m===void 0?"rgba(255, 255, 255, 0)":m,h=e.parentRef,k=e.portalEl,E=k===void 0?document.body:k,f=e.scrollableEl,c=f===void 0?window:f,S=e.transitionDuration,y=S===void 0?300:S,C=e.zoomMargin,M=C===void 0?0:C,w=e.zoomZindex,Z=w===void 0?2147483647:w,D=i.exports.useRef(null),F=i.exports.useState(0),z=F[1],N=i.exports.useState(d),x=N[0],I=N[1],W=i.exports.useState(!1),L=W[0],B=W[1],A=i.exports.useState(!1),T=A[0],X=A[1],Y=$(x),R=$(d),P=$(L),G=Pe(),re=G.width,ae=G.height,oe=i.exports.useCallback(function(p){p.preventDefault(),s&&s(!1)},[s]),U=i.exports.useCallback(function(p){x&&(p.key==="Escape"||p.keyCode===27)&&(p.stopPropagation(),s&&s(!1))},[x,s]),H=i.exports.useCallback(function(){z(function(p){return p+1}),!T&&s&&s(!1)},[T,s]);i.exports.useEffect(function(){return document.addEventListener("keydown",U),function(){document.removeEventListener("keydown",U)}},[U]),i.exports.useEffect(function(){var p;return(p=c==null?void 0:c.addEventListener)===null||p===void 0||p.call(c,"scroll",H),function(){var O;(O=c==null?void 0:c.removeEventListener)===null||O===void 0||O.call(c,"scroll",H)}},[H,c]),i.exports.useEffect(function(){!Y&&x&&(B(!0),D.current&&D.current.focus({preventScroll:!0}))},[x,Y]),i.exports.useEffect(function(){R&&!d&&X(!0),!R&&d&&I(!0)},[d,R]),i.exports.useEffect(function(){var p;return T&&(p=setTimeout(function(){B(!1),I(!1),X(!1)},y)),function(){clearTimeout(p)}},[T,y]),i.exports.useEffect(function(){!P&&L&&o(),P&&!L&&r()},[L,o,r,P]);var Q=h.current||je,j=Q.getBoundingClientRect(),ie=j.height,le=j.left,se=j.top,de=j.width,ce=Ae({isLoaded:L,isUnloading:T,overlayBgColorEnd:v,overlayBgColorStart:g,transitionDuration:y,zoomZindex:Z}),ue=Be({height:ie,isLoaded:L,innerHeight:ae,innerWidth:re,isUnloading:T,left:le,originalTransform:Q.style.transform,top:se,transitionDuration:y,width:de,zoomMargin:M});return x?pe.exports.createPortal(t.createElement("div",{"aria-label":"Zoomed image","aria-modal":!0,"data-rmiz-overlay":!0,role:"dialog",style:ce},t.createElement("div",{"data-rmiz-modal-content":!0,style:ue},n),t.createElement("button",{"aria-label":l,"data-rmiz-btn-close":!0,onClick:oe,ref:D,type:"button"})),E):null},He=i.exports.memo(Ue),Oe=function(e){var n=e.children,a=e.closeText,l=a===void 0?"Unzoom image":a,d=e.isZoomed,o=e.overlayBgColorEnd,r=o===void 0?"rgba(255, 255, 255, 0.95)":o,s=e.overlayBgColorStart,u=s===void 0?"rgba(255, 255, 255, 0)":s,v=e.portalEl,m=e.onZoomChange,g=e.openText,h=g===void 0?"Zoom image":g,k=e.scrollableEl,E=e.transitionDuration,f=E===void 0?300:E,c=e.wrapElement,S=c===void 0?"div":c,y=e.wrapStyle,C=e.zoomMargin,M=C===void 0?0:C,w=e.zoomZindex,Z=w===void 0?2147483647:w,D=i.exports.useState(!1),F=D[0],z=D[1],N=i.exports.useRef(null),x=i.exports.useRef(null),I=i.exports.useCallback(function(A){!d&&m&&(A.preventDefault(),m(!0))},[d,m]),W=i.exports.useCallback(function(){z(!0)},[]),L=i.exports.useCallback(function(){z(!1),x.current&&x.current.focus({preventScroll:!0})},[]),B=F?"hidden":"visible";return t.createElement(i.exports.StrictMode,null,t.createElement(S,{"data-rmiz-wrap":B,ref:N,style:y},n,t.createElement("button",{"aria-label":h,"data-rmiz-btn-open":!0,onClick:I,ref:x,type:"button"}),typeof window<"u"&&t.createElement(He,{closeText:l,isActive:d,onLoad:W,onUnload:L,onZoomChange:m,overlayBgColorEnd:r,overlayBgColorStart:u,parentRef:N,portalEl:v,scrollableEl:k,transitionDuration:f,zoomMargin:M,zoomZindex:Z},n)))},$e=i.exports.memo(Oe);const qe=({pictureUrl:e,productId:n,imageByUser:a})=>{const[l,d]=i.exports.useState(!1),[o,r]=i.exports.useState(void 0),s=n||a,u=v=>{if(s){if(v&&!o){const m=a&&e?e:Le(n,900);r(m)}d(v)}};return t.createElement("div",{className:"block-muted flex flex-col items-center  overflow-auto p-2 md:sticky  md:top-4"},t.createElement($e,{isZoomed:l,onZoomChange:u},t.createElement("img",{className:`mx-auto h-80 w-80 object-scale-down ${l?"hidden":"block"}`,alt:"Bilde av vin",src:e||we}),s&&o&&t.createElement("img",{className:`h-80 w-80 object-scale-down ${l?"block":"hidden"}`,alt:"Bilde av vin",src:o})),s&&t.createElement("p",{className:"text-muted text-sm"},"Trykk p\xE5 bilde for \xE5 zoome inn."))},Ke=({id:e,date:n,deleteDate:a})=>t.createElement("li",{className:"dark:even:bg-gray-950/50 flex flex-row items-center gap-x-2 rounded p-2 even:bg-slate-50"},t.createElement("div",{className:"flex-1 font-medium text-gray-900 dark:text-gray-200"},t.createElement(q,{date:n})),t.createElement("button",{className:"btn-white w-auto p-1 px-1.5 shadow-none",onClick:()=>a(e)},t.createElement(_,{className:"text-wine-500 dark:text-wine-300",size:"1.5rem"}))),Xe=ve.injectEndpoints({endpoints:e=>({getConsumedDatesByWineId:e.query({query(n){return{url:`wine/consumed/${n}`,method:"GET"}},providesTags:n=>n?[...n.map(({id:a})=>({type:"Consumed",id:a})),{type:"Consumed",id:"LIST"}]:[{type:"Consumed",id:"LIST"}]}),deleteConsumedDateById:e.mutation({query(n){return{url:`wine/consumed/${n}`,method:"DELETE"}},invalidatesTags:(n,a,l)=>[{type:"Consumed",id:l},{type:"Statistics",id:"LIST"}]}),addConsumedDate:e.mutation({query({id:n,data:a}){return{url:`wine/consumed/${n}`,method:"POST",body:a}},invalidatesTags:(n,a,l)=>[{type:"Consumed",id:"LIST"},{type:"Statistics",id:"LIST"},{type:"Wines",id:l.id}]})})}),{useGetConsumedDatesByWineIdQuery:Ye,useDeleteConsumedDateByIdMutation:Ge,useAddConsumedDateMutation:Qe}=Xe,Ve=({isOpen:e,setIsOpen:n,wineId:a,quantity:l})=>{const{data:d,isLoading:o}=Ye(a),[r,s]=Qe(),[u]=Ge(),[v,m]=i.exports.useState(null),[g,h]=i.exports.useState(null),k=async()=>{!g||!a||!l||await r({id:a,data:g}).unwrap().then(()=>{h(null),n(!1)}).catch(f=>{"data"in f&&m(f.data.title||"Error! Kunne ikke legge til dato."),console.error("rejected",f)})},E=async f=>{!a||!f||!d||await u(f).unwrap().then(()=>h(null)).catch(c=>{"data"in c&&m(c.data.title||"Error! Kunne ikke legge til dato."),console.error("rejected",c)})};return t.createElement(Ce,{title:"Drukket",description:'Her kan du legge til "drukket-datoer" som lagres p\xE5 vinen.',isOpen:e,setIsOpen:n},t.createElement("div",null,o?t.createElement(J,{text:"Laster datoer..."}):t.createElement(t.Fragment,null,t.createElement(Te,{title:"Hvordan fungerer dette?",defaultOpen:!1},t.createElement("div",{className:"space-y-2 text-gray-700 dark:text-gray-300"},t.createElement("p",null,"En vin kan max ha 10 drukket-datoer, den eldste datoen vil bli",t.createElement("span",{className:"font-bold"}," overskrevet")," automatisk. N\xE5r du legger til en drukket dato vil vinens antall"," ",t.createElement("span",{className:"font-bold"},"reduseres")," med 1. Du kan ikke registrere drukket datoer p\xE5 vin du ikke har p\xE5 lager, alts\xE5 hvor antall er lik 0."),t.createElement("p",null,"P\xE5 profilsiden kan du se de 10 siste drukket-datoene fra alle vin, mens p\xE5 denne siden vises kun drukket-datoer som h\xF8rer til valgt vin."))),v&&t.createElement(ee,{message:v}),d&&d.length>0?t.createElement("div",{className:"block-muted my-4 rounded-lg p-2"},t.createElement("h3",{className:"mb-2 border-b pb-2 text-center text-sm font-medium dark:border-gray-700"},"Drukket"),t.createElement("ul",{className:"space-y-1"},d.map(f=>t.createElement(Ke,{deleteDate:E,date:f.date,id:f.id,key:f.id})))):t.createElement(K,{message:"Ingen datoer er registrert enda."}),!l&&t.createElement(K,{message:"Du har ikke vinen p\xE5 lager."}),t.createElement("div",{className:"block-less-muted mt-4 space-y-6 rounded-lg p-4"},t.createElement("div",null,t.createElement("label",{className:"label"},"Velg dato"),t.createElement(ke,{text:"Velg dato",value:g,onChange:h,hereafter:!1,absolute:!1})),t.createElement("div",{className:"mt-4 grid grid-cols-1 gap-2"},t.createElement(be,{onClick:k,loading:o||s.isLoading,disabled:!g||!l,loadingText:"Legger til dato...",className:"h-12 justify-center rounded-full"},"Legg til dato"))))))},mt=()=>{const{wine:e,id:n,status:a}=Me(),[l,d]=i.exports.useState(!1),[o,r]=i.exports.useState(!1);if(n){if(a.isLoading)return t.createElement(J,{text:"Laster..."});if(a.isError)return t.createElement(ee,{message:`Kunne ikke finne vinen med id: ${n}`});if(a.isSuccess&&e)return t.createElement(t.Fragment,null,t.createElement("div",null,t.createElement(Ne,{title:e.name,border:!0,node:t.createElement("div",{className:`flag f32 ${e.countryId}`}),highlighted:!0}),t.createElement("div",{className:"my-4 flex flex-col gap-y-4 sm:flex-row sm:items-center sm:justify-between"},t.createElement("div",{className:"flex flex-row gap-y-2"},t.createElement(he,{className:"btn-white xs:gap-x-2 xs:px-4 flex w-auto items-center justify-center gap-x-0.5 rounded-full rounded-r-none px-3",to:"update"},t.createElement(Ee,{size:"1.25rem",weight:"duotone",className:"text-slate-700 dark:text-slate-400"}),"Rediger"),t.createElement("button",{onClick:()=>r(!0),className:"btn-white xs:gap-x-2 xs:px-4 flex w-auto items-center justify-center gap-x-0.5 rounded-none border-l-0 px-3"},t.createElement(De,{size:"1.25rem",weight:"duotone",className:"text-slate-700 dark:text-slate-400"}),"Drukket"),e.productId&&t.createElement("a",{className:"btn-white xs:gap-x-2 xs:px-4 flex w-auto items-center justify-center gap-x-0.5 rounded-none border-l-0 px-3",href:Se(e.productId),target:"_blank",rel:"noreferrer"},t.createElement(Ie,{size:"1.25rem",weight:"duotone",className:"text-slate-700 dark:text-slate-400"}),"Link"),t.createElement("button",{onClick:()=>d(!0),className:"btn-white xs:gap-x-2 xs:px-4 flex w-auto items-center justify-center gap-x-0.5 rounded-full rounded-l-none border-l-0 px-3"},t.createElement(_,{size:"1.25rem",weight:"duotone",className:"text-wine-500 dark:text-wine-300"}),"Slett")),t.createElement("div",{className:"text-muted text-sm"},t.createElement("p",null,"Dato opprettet: ",t.createElement(q,{date:e.createdAt})),t.createElement("p",null,"Sist endret:"," ",t.createElement(q,{date:e.updatedAt,fallBackText:"Ingen endring"})))),t.createElement("div",{className:"grid grid-cols-1 gap-y-4 md:grid-cols-3 md:gap-x-4 md:gap-y-0 "},t.createElement("div",{className:"col-span-2"},t.createElement(ye,{wine:e})),t.createElement("div",{className:"relative row-start-1 pl-0 md:row-start-auto"},!e.userDetails.quantity&&t.createElement(K,{className:"mt-0",message:"Du har ikke vinen p\xE5 lager."}),t.createElement(qe,{productId:e.productId,pictureUrl:e.pictureUrl,imageByUser:e.imageByUser})))),t.createElement(Ve,{wineId:e.wineId,isOpen:o,quantity:e.userDetails.quantity,setIsOpen:r}),t.createElement(xe,{isOpen:l,setIsOpen:d,shouldNavigate:!0,wineToDelete:{id:n,name:e.name}}))}else return t.createElement(ge,null);return null};export{mt as default};
